(()=>{"use strict";let e=null,t=null,n=null,o=null,i=null,r=!1;function a(e,t,o){if(!n)return;let i=`Processed: ${e}`;t>0&&(i+=` / ${t}`),void 0!==o&&(i+=` • ${o.toFixed(1)}s elapsed`),n.textContent=i}function l(e){t&&(t.textContent=e)}let c=!1,s=0,d=0,u=0,p=0;function m(e,t){const n=document.createElement("button");return n.textContent=e,n.className="li-bulk-action-button",Object.assign(n.style,{backgroundColor:"#0a66c2",color:"white",border:"none",borderRadius:"24px",padding:"8px 16px",fontWeight:"bold",fontSize:"14px",cursor:"pointer",transition:"background-color 0.2s"}),n.addEventListener("mouseover",()=>{n.style.backgroundColor="#084d93"}),n.addEventListener("mouseout",()=>{n.style.backgroundColor="#0a66c2"}),n.addEventListener("click",t),n}async function g(){f("Accepting Invitations","Accept")}async function y(){f("Denying Invitations","Ignore")}async function f(m,g){if(!document.getElementById("li-bulk-overlay")){c=!1,d=0,p=0,u=0,s=Date.now(),function(a){e&&removeOverlay(),e=document.createElement("div"),e.id="li-bulk-overlay",e.setAttribute("role","status"),e.setAttribute("aria-live","polite"),Object.assign(e.style,{position:"fixed",bottom:"20px",right:"20px",backgroundColor:"white",borderRadius:"8px",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.1)",padding:"16px",zIndex:"9999",fontFamily:'system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',display:"flex",flexDirection:"column",minWidth:"250px",border:"1px solid #e0e0e0"});const c=document.createElement("div");Object.assign(c.style,{fontWeight:"bold",marginBottom:"8px",display:"flex",justifyContent:"space-between",alignItems:"center"});const s=document.createElement("span");s.textContent=a,Object.assign(s.style,{color:"#0a66c2"}),c.appendChild(s),n=document.createElement("div"),n.textContent="Initializing...",Object.assign(n.style,{margin:"8px 0",fontSize:"14px"}),t=document.createElement("div"),t.textContent="Starting...",Object.assign(t.style,{fontSize:"12px",color:"#666",marginBottom:"12px"}),o=document.createElement("button"),o.textContent="Stop",o.setAttribute("aria-label","Stop current action"),Object.assign(o.style,{backgroundColor:"#d11124",color:"white",border:"none",borderRadius:"4px",padding:"6px 12px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",alignSelf:"flex-end"}),o.addEventListener("click",()=>{"function"==typeof i&&(i(),l("Stopping..."),o.disabled=!0,o.textContent="Stopping...",Object.assign(o.style,{backgroundColor:"#999",cursor:"default"}))}),e.appendChild(c),e.appendChild(n),e.appendChild(t),e.appendChild(o),document.body.appendChild(e),r=!0}(m),l("Starting..."),i=()=>{c=!0,l("Stopping at next opportunity...")};try{const i=(await async function(){return new Promise(e=>{chrome.runtime.sendMessage({action:"getSettings"},t=>{e(t)})})}()).delayMs;for(;!c&&(!await k()||!c);){const e=b(g);0===u&&(u=x(),a(d,u,w()));for(let t=0;t<e.length&&!c;t++){const n=e[t];try{if(n.click(),d++,a(d,u,w()),l(`Processing invitation ${d}`),await h(),await v(i/3),d%5==0&&await k()&&c)break}catch(e){console.error("Error processing invitation:",e),p++,l(`Skipped invitation (${p} total skipped)`)}}if(0===e.length&&(window.scrollTo(0,document.body.scrollHeight),l("Loading more invitations..."),!await C()))break}const s="Accept"===g?"Accepted":"Denied";let m="";c?m=`Cancelled – ${d} invitations ${s.toLowerCase()}`:(m=`${s} ${d} invitations`,p>0&&(m+=` (${p} skipped)`)),y=m,e&&(n&&(n.textContent=y),t&&(t.textContent="Completed"),o&&(o.disabled=!0,o.textContent="Done",Object.assign(o.style,{backgroundColor:"#0a66c2",cursor:"default"}),setTimeout(()=>{e&&e.parentNode&&(e.parentNode.removeChild(e),e=null,t=null,n=null,o=null,r=!1)},5e3)))}catch(e){console.error("Bulk action error:",e),l(`Error: ${e.message}`)}}var y}function b(e){let t=Array.from(document.querySelectorAll(`button[aria-label*="${e}"]`));return 0===t.length&&(t=Array.from(document.querySelectorAll("button")).filter(t=>{const n=t.textContent.trim();return n===e||n===e+" invitation"})),t}function x(){return document.querySelectorAll(".invitation-card__container").length}async function h(){await v(200);const e=document.querySelectorAll('button[aria-label="Dismiss"]'),t=document.querySelectorAll('button[aria-label="Close"]');e.length>0?(e[0].click(),await v(100)):t.length>0&&(t[0].click(),await v(100))}async function C(){const e=x();let t=0;for(;t<4;){if(await v(200),x()>e)return!0;t++}return!1}function v(e){return new Promise(t=>setTimeout(t,e))}function w(){return(Date.now()-s)/1e3}async function k(){const e=document.querySelector('iframe[src*="challenge"]'),t=["security check","please verify","confirm you are not a robot","check your network","unusual amount of activity","too many requests","rate limit","try again later"],n=document.querySelectorAll("p, h1, h2, h3, div, span");let o=null;for(const e of n){const n=e.textContent.toLowerCase();if(t.some(e=>n.includes(e))){o=e;break}}if(e||o){l("Paused – resolve security challenge to continue"),a(d,u,w());let e=!1,n=0;const i=1e3,r=3e5/i;for(;!e&&!c&&n<r;){await v(i),n++;const r=document.querySelector('iframe[src*="challenge"]');let a=!1;o&&document.body.contains(o)&&(a=t.some(e=>o.textContent.toLowerCase().includes(e))),r||a||(e=!0),e||n%5!=0||l(`Waiting for security challenge to be resolved (${Math.floor(n/60)}m)`)}return e?(l("Security challenge resolved, resuming..."),await v(1e3),!0):(c||(l("Timed out waiting for security challenge resolution"),c=!0),!0)}return!1}document.addEventListener("DOMContentLoaded",function(){if(!window.location.href.includes("/mynetwork/invitation-manager/"))return;const e=document.createElement("div");e.className="li-bulk-action-buttons",Object.assign(e.style,{display:"flex",gap:"12px",margin:"16px 0",padding:"0 16px"});const t=m("Accept All",g),n=m("Deny All",y);e.appendChild(t),e.appendChild(n);const o=document.querySelector("header")||document.querySelector(".scaffold-layout__header")||document.querySelector("main");o&&o.parentNode?o.parentNode.insertBefore(e,o):document.body.insertBefore(e,document.body.firstChild)})})();