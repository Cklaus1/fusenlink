(()=>{"use strict";async function e(){return new Promise(e=>{chrome.runtime.sendMessage({action:"getSettings"},t=>{e(t)})})}let t=null,n=null,o=null,r=null,i=null,l=!1;function c(e,t,n){if(!o)return;let r=`Processed: ${e}`;t>0&&(r+=` / ${t}`),void 0!==n&&(r+=` • ${n.toFixed(1)}s elapsed`),o.textContent=r}function a(e){n&&(n.textContent=e)}let s=!1,u=0,d=0,m=0,p=0,f=50;function b(){const e=[],t=Array.from(document.querySelectorAll("button")).filter(e=>"connect"===e.textContent.trim().toLowerCase()&&!e.closest('[aria-hidden="true"]'));e.push(...t);const n=Array.from(document.querySelectorAll("button")).filter(e=>{const t=e.textContent.trim().toLowerCase();return("more"===t||t.includes("more"))&&!e.closest('[aria-hidden="true"]')});return e.push(...n),e}async function y(){await x(500);const e=Array.from(document.querySelectorAll("button")).filter(e=>{const t=e.textContent.trim().toLowerCase();return("send"===t||"send now"===t)&&null!==e.offsetParent});if(e.length>0)return e[0].click(),!0;const t=document.querySelectorAll('button[aria-label="Dismiss"]'),n=document.querySelectorAll('button[aria-label="Close"]');return t.length>0?t[0].click():n.length>0&&n[0].click(),!1}function g(){return document.querySelectorAll(".reusable-search__result-container").length}async function h(){const e=g();let t=0;for(;t<10;){if(await x(200),g()>e)return!0;t++}return!1}function x(e){return new Promise(t=>setTimeout(t,e))}function C(){return(Date.now()-u)/1e3}function w(){const e=document.querySelectorAll('[role="menuitem"]');for(const t of e)if("connect"===t.textContent.trim().toLowerCase())return t;const t=Array.from(document.querySelectorAll(".artdeco-dropdown__content button, .artdeco-dropdown-item")).filter(e=>"connect"===e.textContent.trim().toLowerCase()&&null!==e.offsetParent);return t.length>0?t[0]:null}function v(){const e=document.querySelector('.artdeco-dropdown__content [aria-label="Close"]');e?e.click():(document.body.click(),document.dispatchEvent(new KeyboardEvent("keydown",{key:"Escape",bubbles:!0})))}async function k(){const e=document.querySelector('iframe[src*="challenge"]'),t=["security check","please verify","confirm you are not a robot","check your network","unusual amount of activity","too many requests","rate limit","try again later"],n=document.querySelectorAll("p, h1, h2, h3, div, span");let o=null;for(const e of n){const n=e.textContent.toLowerCase();if(t.some(e=>n.includes(e))){o=e;break}}if(e||o){a("Paused – resolve security challenge to continue"),c(d,p,C());let e=!1,n=0;const r=1e3,i=3e5/r;for(;!e&&!s&&n<i;){await x(r),n++;const i=document.querySelector('iframe[src*="challenge"]');let l=!1;o&&document.body.contains(o)&&(l=t.some(e=>o.textContent.toLowerCase().includes(e))),i||l||(e=!0),e||n%5!=0||a(`Waiting for security challenge to be resolved (${Math.floor(n/60)}m)`)}return e?(a("Security challenge resolved, resuming..."),await x(1e3),!0):(s||(a("Timed out waiting for security challenge resolution"),s=!0),!0)}return!1}document.addEventListener("DOMContentLoaded",async function(){if(window.location.href.includes("/search/results/"))try{const S=await e();f=S.maxInvites;const E=function(f){const S=document.createElement("button");return S.textContent=`Invite ≤ ${f}`,S.className="li-bulk-invite-button",Object.assign(S.style,{backgroundColor:"#0a66c2",color:"white",border:"none",borderRadius:"24px",padding:"8px 16px",fontWeight:"bold",fontSize:"14px",cursor:"pointer",transition:"background-color 0.2s"}),S.addEventListener("mouseover",()=>{S.style.backgroundColor="#084d93"}),S.addEventListener("mouseout",()=>{S.style.backgroundColor="#0a66c2"}),S.addEventListener("click",()=>{!async function(f){if(!document.getElementById("li-bulk-overlay")){var S;s=!1,d=0,m=0,p=0,u=Date.now(),function(){t&&removeOverlay(),t=document.createElement("div"),t.id="li-bulk-overlay",t.setAttribute("role","status"),t.setAttribute("aria-live","polite"),Object.assign(t.style,{position:"fixed",bottom:"20px",right:"20px",backgroundColor:"white",borderRadius:"8px",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.1)",padding:"16px",zIndex:"9999",fontFamily:'system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',display:"flex",flexDirection:"column",minWidth:"250px",border:"1px solid #e0e0e0"});const e=document.createElement("div");Object.assign(e.style,{fontWeight:"bold",marginBottom:"8px",display:"flex",justifyContent:"space-between",alignItems:"center"});const c=document.createElement("span");c.textContent="Sending Connection Requests",Object.assign(c.style,{color:"#0a66c2"}),e.appendChild(c),o=document.createElement("div"),o.textContent="Initializing...",Object.assign(o.style,{margin:"8px 0",fontSize:"14px"}),n=document.createElement("div"),n.textContent="Starting...",Object.assign(n.style,{fontSize:"12px",color:"#666",marginBottom:"12px"}),r=document.createElement("button"),r.textContent="Stop",r.setAttribute("aria-label","Stop current action"),Object.assign(r.style,{backgroundColor:"#d11124",color:"white",border:"none",borderRadius:"4px",padding:"6px 12px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",alignSelf:"flex-end"}),r.addEventListener("click",()=>{"function"==typeof i&&(i(),a("Stopping..."),r.disabled=!0,r.textContent="Stopping...",Object.assign(r.style,{backgroundColor:"#999",cursor:"default"}))}),t.appendChild(e),t.appendChild(o),t.appendChild(n),t.appendChild(r),document.body.appendChild(t),l=!0}(),a("Starting..."),i=()=>{s=!0,a("Stopping at next opportunity...")};try{const i=(await e()).delayMs;for(;!s&&d<f&&(!await k()||!s);){const e=b();if(0===p&&(p=Math.min(g(),f),c(d,p,C())),0!==e.length)for(let t=0;t<e.length&&!(s||d>=f);t++){const n=e[t];try{if(n._hasDropdownInfo){n.click(),await x(300);const e=w();e?(e.click(),await x(300),await y()?(d++,c(d,p,C()),a(`Sent invitation ${d} of ${f}`)):(m++,a(`Skipped invitation (${m} total skipped)`))):(v(),m++,a(`No Connect option in dropdown (${m} total skipped)`))}else n.click(),await x(300),await y()?(d++,c(d,p,C()),a(`Sent invitation ${d} of ${f}`)):(m++,a(`Skipped invitation (${m} total skipped)`));if(d%5==0&&await k()&&s)break;await x(i)}catch(e){console.error("Error sending invitation:",e),m++,a(`Error: ${e.message}`)}}else if(window.scrollTo(0,document.body.scrollHeight),a("Loading more results..."),!await h()){a("No more profiles with Connect button found");break}}let u="";u=s?`Cancelled – ${d} invitations sent`:d>=f?`Completed – ${d} invitations sent`:`No more profiles – ${d} invitations sent`,m>0&&(u+=` (${m} skipped)`),S=u,t&&(o&&(o.textContent=S),n&&(n.textContent="Completed"),r&&(r.disabled=!0,r.textContent="Done",Object.assign(r.style,{backgroundColor:"#0a66c2",cursor:"default"}),setTimeout(()=>{t&&t.parentNode&&(t.parentNode.removeChild(t),t=null,n=null,o=null,r=null,l=!1)},5e3)))}catch(e){console.error("Bulk invite error:",e),a(`Error: ${e.message}`)}}}(f)}),S}(f);await async function(e,t=5e3){return new Promise(n=>{const o=document.querySelector(e);if(o)return void n(o);const r=new MutationObserver((t,o)=>{const r=document.querySelector(e);r&&(o.disconnect(),n(r))});r.observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>{r.disconnect(),n(null)},t)})}(".search-reusables__filters-bar");const q=document.querySelector(".search-reusables__filters-bar")||document.querySelector(".search-results-container");if(q){const e=document.createElement("div");e.className="li-bulk-invite-container",Object.assign(e.style,{display:"inline-flex",alignItems:"center",marginLeft:"12px"}),e.appendChild(E),q.appendChild(e)}}catch(e){console.error("Error initializing Invite button:",e)}})})();